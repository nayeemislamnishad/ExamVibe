<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ExamVibe</title>
<link rel="icon" href="ExamVibe.ico" type="image/x-icon">
<link rel="stylesheet" href="styles.css">
<script>
    let gucco1 = "";
    let totalCount = 0;
    let answersSubmitted = false;
    let countdownTimer;
    let startTime;
    let endTime;
    let isAutomaticSubmission = false;

    function validateAnswers() {
        const answers = document.getElementById('answers').value;
        const errorMessage = document.getElementById('error-message');
        const submitButton = document.getElementById('generatedText');
        const isValid = /^[abcd]+$/.test(answers);

        if (!isValid) {
            errorMessage.textContent = "Please use only 'a', 'b', 'c', 'd' (lowercase letters only).";
            errorMessage.style.color = 'red';
            submitButton.disabled = true;
        } else {
            gucco1 = answers.split('').reverse().join('');
            errorMessage.textContent = "";
            submitButton.disabled = false;
            document.getElementById('noteIt').style.display = 'block';
            const questionNumber = gucco1.length;
            const timeInseconds = questionNumber * 20;
            const timeInMinutes = timeInseconds / 60;
            const timerDuration = Math.ceil(timeInMinutes);
            const resultDiv = document.getElementById('noteIt');
            const message = `Number of questions: <span class="highlight"> ${questionNumber} </span> <br> You will get üëâ<span class="highlight"> ${timerDuration} minutes </span> to give this exam`;
            resultDiv.innerHTML = message;
            console.log(gucco1);
        }
    }

    function generateAnswerSheet() {
        if (confirm("Are you sure you want to generate the answer sheet?")) {
            startReviseTimer();
        }
    }

    function startReviseTimer() {
        let timeLeft = 15;
        const timerElement = document.getElementById('timer');
        const submitButton = document.getElementById('generatedText');

        submitButton.style.display = 'none';
        timerElement.style.display = 'block';

        const timerInterval = setInterval(() => {
            if (timeLeft > 0) {
                timerElement.textContent = timeLeft;
                timeLeft--;
            } else {
                clearInterval(timerInterval);
                timerElement.textContent = 'Ready... 1, 2, 3, Go!';
                setTimeout(() => {
                    timerElement.style.display = 'none';
                    startExam();
                }, 2000); 
            }
        }, 1000);
    }

    function startExam() {
        const questionNumber = gucco1.length;
        const timeInseconds = questionNumber * 20;
        const timeInMinutes = timeInseconds / 60;
        const timerDuration = Math.ceil(timeInMinutes);
        if (!answersSubmitted && !confirm("Are you ready for the exam? Ok, Let's start....")) {
            return;
        }
        startTime = new Date().toLocaleString();
        let answerSheetHTML = '<h2>OMR Answer Sheet</h2>';
        for (let i = 1; i <= questionNumber; i++) {
            answerSheetHTML += `<div id="question${i}"><strong> ${i}:</strong> `;
            for (let j = 0; j < 4; j++) {
                const option = String.fromCharCode(97 + j);
                answerSheetHTML += `<div class="option" onclick="selectOption(this, '${option}', ${i})">${option}</div>`;
            }
            answerSheetHTML += `</div>`;
        }
        document.getElementById('answerSheet').innerHTML = answerSheetHTML;
        hideAll();
        document.getElementById('submittext').style.display = 'block';
        document.getElementById('answerSheet').style.display = 'block';
        document.getElementById('timer').style.display = 'block';
        const timerDisplay = document.getElementById('timer');
        startTimer(timerDuration * 60, timerDisplay);
        totalCount = parseInt(questionNumber);
    }

    function startTimer(duration, display) {
        let timer = duration, minutes, seconds;
        countdownTimer = setInterval(function () {
            minutes = parseInt(timer / 60, 10);
            seconds = parseInt(timer % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            display.textContent = minutes + ":" + seconds;
            if (--timer < 0) {
                clearInterval(countdownTimer);
                isAutomaticSubmission = true;
                submitAnswers();
            }
        }, 1000);
    }

    function selectOption(option, letter, questionNumber) {
        if (answersSubmitted) return;
        const options = option.parentNode.querySelectorAll('.option');
        options.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        option.dataset.questionNumber = questionNumber;
        console.log(`Selected option ${letter} for Question ${questionNumber}`);
    }

    function submitAnswers() {
        const idToHide = document.getElementById('submittext');
        if (!isAutomaticSubmission && !confirm("Are you sure you want to submit your answers? You won't be able to change them later.")) {
            return;
        }
        if (answersSubmitted) return;
        answersSubmitted = true;
        clearInterval(countdownTimer);
        endTime = new Date().toLocaleString();
        idToHide.style.display = 'none';
        const selectedOptions = document.querySelectorAll('.option.selected');
        const correctAnswers = gucco1.split('');
        let totalMarks = 0;
        let answeredQuestions = [];

        selectedOptions.forEach(option => {
            const selectedLetter = option.textContent.trim();
            const correctLetter = correctAnswers[option.dataset.questionNumber - 1].trim();
            const questionNumber = parseInt(option.dataset.questionNumber);
            if (selectedLetter === correctLetter) {
                option.classList.add('correct');
                totalMarks += 1;
            } else {
                option.classList.add('incorrect');
                totalMarks -= 0.25;
            }
            option.classList.remove('selected');
            answeredQuestions.push(questionNumber);
        });

        for (let i = 1; i <= totalCount; i++) {
            if (!answeredQuestions.includes(i)) {
                const questionDiv = document.getElementById(`question${i}`);
                questionDiv.innerHTML += `<div class="option skip">skipped</div>`;
            }
        }

        document.getElementById('originalMarks').style.display = 'block';
        let output = "Marks: " + totalMarks.toFixed(2) + "/" + totalCount;
        document.getElementById("originalMarks").textContent = output;

        const original_marks = (totalMarks * 100) / totalCount;
        const actual_marks = original_marks.toFixed(2);
        const feedbackMessage = getFeedbackMessage(actual_marks);
        const feedbackElement = document.createElement('div');
        feedbackElement.textContent = feedbackMessage;
        feedbackElement.classList.add('feedback-message');
        const answerSheetContainer = document.getElementById('answerSheet');
        answerSheetContainer.appendChild(feedbackElement);
        const justifyUser = document.createElement('div');
        justifyUser.innerHTML = "Start Time: " + startTime + "<br>" + "Submit Time: " + endTime;
        justifyUser.classList.add('justifyUserDesign');
        const justifyUserContainer = document.getElementById('answerSheet');
        justifyUserContainer.appendChild(justifyUser);
        const scratches = document.createElement('div');
        scratches.classList.add('scratches');
        justifyUser.appendChild(scratches);

        const options = document.querySelectorAll('.option');
        options.forEach(opt => opt.onclick = null);
        for (let i = 1; i <= correctAnswers.length; i++) {
            const correctLetter = correctAnswers[i - 1];
            const questionDiv = document.getElementById(`question${i}`);
            questionDiv.innerHTML += `<div class="correct-answer">Correct Answer: ${correctLetter}</div>`;
        }

        isAutomaticSubmission = false;

        window.onbeforeunload = function () {
            if (!answersSubmitted) {
                return "Are you sure you want to leave? Your answers will be lost.";
            }
        };

        window.onbeforeunload = function () {
            if (totalMarks !== null) {
                return "You have submitted your answers. Are you sure you want to leave the page?";
            }
        };
    }

    function hideAll() {
        const divIdsToHide = ['questionNumber', 'timerDuration', 'generatedText', 'questionnumbertext', 'timetext', 'headtext'];
        divIdsToHide.forEach(id => {
            const divToHide = document.getElementById(id);
            if (divToHide) {
                divToHide.style.display = 'none';
            }
        });
    }

    function getFeedbackMessage(marks) {
        if (marks >= 85 && marks <= 100) {
            return `You will top in any national level exam InshaAllah. You Obtained: ${marks}/100`;
        } else if (marks >= 75 && marks < 85) {
            return `Keep going, you're doing well. At least you will get a good subject in university exams InshaAllah! You obtained: ${marks}/100`;
        } else if (marks >= 50 && marks < 75) {
            return `You can do better, keep practicing. Have to do better! You obtained: ${marks}/100`;
        } else {
            return `Don't give up, keep working hard! Your Position is not good. You obtained: ${marks}/100`;
        }
    }
</script>
</head>
<body>
    <br><br>
    <div class="container">
        <h2 id="originalMarks"></h2>
        <div id="needToKnow">
            <p>‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ü‡¶ø‡¶§‡ßá ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá‡¶® ‡¶∏‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ü‡¶ø‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶ó‡ßá‡¶á ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶®‡•§ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã reverse ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶®‡•§ <br> ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£ : ‡¶Ø‡¶¶‡¶ø ‡ßß,‡ß®,‡ß©,‡ß™ ‡¶ì ‡ß´ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ø‡¶•‡¶æ‡¶ï‡ßç‡¶∞‡¶Æ‡ßá ‡¶è‡¶Æ‡¶® ‡¶π‡¶Ø‡¶º ‡¶Ø‡ßá : dacba ‡¶§‡¶¨‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶è‡¶≠‡¶æ‡¶¨‡ßá : abcad(reverse mode)‡•§ <br> ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ü‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ‡¶á ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá ‡¶®‡¶æ ‡•§‡¶∂‡ßÅ‡¶ß‡ßÅ  generate AnswerSheet ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶ï‡ßç‡¶∑‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</p>
        </div>
        <h2 id="needTag">Enter Correct Answers in reverse </h2>
        <input type="text" id="answers" placeholder="Enter answers like adaccadadccaa" oninput="validateAnswers()">
        <div id="error-message"></div>
        <div id="noteIt"></div>
        <button onclick="generateAnswerSheet()" id="generatedText">Generate Answer Sheet</button>
        <div id="result" style="float: right; margin-right: 10px;"></div>
        <div id="answerSheet"></div>
        <div id="timer"></div>
        <button onclick="submitAnswers()" id="submittext">Submit Answers</button>
    </div>
    <div class="scroll-to-bottom"></div>
    <script src="script.js"></script>
    <script>
        let uploaded = false;
        function previewImage(event) {
            var reader = new FileReader();
            reader.onload = function () {
                var output = document.getElementById('image-preview');
                output.innerHTML = '<img src="' + reader.result + '" alt="Uploaded Image">';
                uploaded = true;
            };
            reader.readAsDataURL(event.target.files[0]);
        }
        window.addEventListener('beforeunload', function (e) {
            if (uploaded) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
        document.addEventListener('DOMContentLoaded', function() {
            const submitBtn = document.getElementById('submittext');
            submitBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: document.body.scrollHeight,
                    behavior: 'smooth'
                });
            });
        });
    </script>
    <script>
        function checkLoginStatus() {
            const isLoggedIn = sessionStorage.getItem("isLoggedIn");
            if (!isLoggedIn) {
                window.location.href = "index.html";
            }
        }
        window.addEventListener("DOMContentLoaded", () => {
            checkLoginStatus();
        });
    </script>
</body>
</html>
